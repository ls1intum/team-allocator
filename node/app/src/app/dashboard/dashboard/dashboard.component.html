<!-- team containers -->
<div class="dashboard flex-row">
  <div *ngFor="let team of teams" class="hidden-scrollbar-parent">
    <div class="hidden-scrollbar-child flex-column">
      <app-team class="flex-no-shrink" [team]="team"></app-team>
    </div>
  </div>
</div>

<!-- person pool -->
<div *ngIf="orphanTeam" class="person-pool flex-column overflow-hidden"
     [ngClass]="getPersonPoolDisplayModeCSSClass(personPoolDisplayMode)">
  <!-- title and buttons -->
  <div class="flex-row flex-center person-pool-title-bar flex-no-shrink">
    <div class="person-pool-label flex-no-shrink">Person Pool</div>
    <div class="team-person-count flex-row flex-center flex-justify-center flex-no-shrink">
      <div *ngIf="orphanTeam">{{orphanTeam.persons.length}}</div>
    </div>
    <div class="flex-grow"></div>

    <button md-raised-button color="primary" class="distribute-button flex-no-shrink"
            (click)="togglePersonPoolStatistics()">
      <div class="flex-row flex-center distribute-button-row">
        <md-icon class="flex-spacing-x-2px material-icon-trailing-space">timeline</md-icon>
        <div>{{ statisticsVisible ? 'Hide' : 'Show' }} Statistics</div>
      </div>
    </button>
    <button md-raised-button color="primary" class="distribute-button flex-no-shrink" (click)="openConstraintsDialog()">
      <div class="flex-row flex-center distribute-button-row">
        <md-icon class="flex-spacing-x-2px material-icon-trailing-space">build</md-icon>
        <div>Distribute With Constraints</div>
      </div>
    </button>
    <div class="btn-group btn-group-sm" ngbRadioGroup name="radioBasic" [(ngModel)]="personPoolDisplayMode"
         (ngModelChange)="onPersonPoolDisplayModeChange()">
      <label ngbButtonLabel class="btn-secondary">
        <input ngbButton type="radio" [value]="PersonPoolDisplayMode.Closed">
        <img src="/assets/images/person-pool-closed.svg" class="person-pool-size-icon">
      </label>
      <label ngbButtonLabel class="btn-secondary">
        <input ngbButton type="radio" [value]="PersonPoolDisplayMode.OneRow">
        <img src="/assets/images/person-pool-one-row.svg" class="person-pool-size-icon">
      </label>
      <label ngbButtonLabel class="btn-secondary">
        <input ngbButton type="radio" [value]="PersonPoolDisplayMode.TwoRows">
        <img src="/assets/images/person-pool-two-rows.svg" class="person-pool-size-icon">
      </label>
      <label ngbButtonLabel class="btn-secondary">
        <input ngbButton type="radio" [value]="PersonPoolDisplayMode.Full">
        <img src="/assets/images/person-pool-full.svg" class="person-pool-size-icon">
      </label>
    </div>
  </div>

  <!-- person pool statistics -->
  <div *ngIf="statisticsVisible" class="flex-column statistics-container flex-no-shrink">
    <div class="statistics-title-label">Statistics</div>
    <div class="statistics-sublabel">Priority Distribution</div>
    <div class="statistics-horizontal-divider"></div>

    <!-- legend labels top -->
    <div class="flex-row flex-">
      <div class="statistics-legend-placeholder"></div>
      <div class="flex-row flex-grow">
        <div class="statistics-legend-label"
             *ngFor="let label of priorityDistributionLabels"
             [style.flex-grow]="label[1]">
          {{ label[0] }}
        </div>
      </div>
    </div>

    <!-- colored bars -->
    <div *ngFor="let team of teams" class="flex-row">
      <div class="statistics-team-label">{{ team.name }}</div>
      <div class="statistics-divider"></div>
      <div class="flex-row flex-grow">
        <div *ngFor="let i of teamIndices"
             class="priority-bar flex-row flex-center"
             [style.flex-grow]="priorityDistributionStatistics.get(team)[i]"
             [style.background-color]="getColorOfTeamDistributionBar(i)"
             [style.display]="priorityDistributionStatistics.get(team)[i] === 0 ? 'none' : null">
          <div class="statistics-priority-index-label">{{ i + 1 }}</div>
          <div class="statistics-bar-person-count">{{ priorityDistributionStatistics.get(team)[i] }}x</div>
        </div>
      </div>
    </div>

    <!-- legend labels bottom -->
    <div class="flex-row flex-">
      <div class="statistics-legend-placeholder"></div>
      <div class="flex-row flex-grow">
        <div class="statistics-legend-label"
             *ngFor="let label of priorityDistributionLabels"
             [style.flex-grow]="label[1]">
          {{ label[0] }}
        </div>
      </div>
    </div>

    <!-- general statistics -->
    <div class="statistics-sublabel">Overview</div>
    <div class="statistics-horizontal-divider"></div>
    <div class="flex-column">

      <!-- header -->
      <div class="flex-row statistics-general-header">
        <div class="flex-neutral-grow"></div>
        <div class="flex-neutral-grow statistics-general-header">Total</div>
        <div class="flex-neutral-grow statistics-general-header">Average</div>
        <div class="flex-neutral-grow statistics-general-header">Average per Team</div>
      </div>

      <!-- skill level stats -->
      <div *ngFor="let skillLevel of [SkillLevel.Low, SkillLevel.Medium, SkillLevel.High, SkillLevel.VeryHigh]"
           class="flex-row flex-center">
        <div class="flex-neutral-grow flex-row flex-center flex-no-shrink">
          <div class="statistics-general-header">Persons with</div>
          <div class="statistics-skill-level-badge"
               [style.background-color]="Colors.getColor(skillLevel)">
            {{ Skill.getLabelForSkillLevel(skillLevel) }}
          </div>
          <div class="statistics-general-header">Rating</div>
        </div>
        <div class="flex-neutral-grow">{{ getNumberOfPersonsWithSupervisorRating(skillLevel) }}</div>
        <div class="flex-neutral-grow">
          {{ Math.round(getNumberOfPersonsWithSupervisorRating(skillLevel) * 100 / getNumberOfPersons()) / 100 }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round(getNumberOfPersonsWithSupervisorRating(skillLevel) * 100 / teams.length) / 100 }}
        </div>
      </div>

      <!-- iOS Devices -->
      <div class="flex-row flex-center">
        <div class="flex-neutral-grow flex-no-shrink statistics-general-header">
          Persons with iOS Devices
        </div>
        <div class="flex-neutral-grow">
          {{ getTotalNumberOfDeviceType(Device.Ipad) + getTotalNumberOfDeviceType(Device.Iphone) }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round( (getTotalNumberOfDeviceType(Device.Ipad) + getTotalNumberOfDeviceType(Device.Iphone)) * 100 /
          getNumberOfPersons()) / 100 }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round( (getTotalNumberOfDeviceType(Device.Ipad) + getTotalNumberOfDeviceType(Device.Iphone)) * 100 /
          teams.length) / 100 }}
        </div>
      </div>

      <!-- iOS Devices -->
      <div class="flex-row flex-center">
        <div class="flex-neutral-grow flex-no-shrink statistics-general-header">
          Persons with Mac Devices
        </div>
        <div class="flex-neutral-grow">
          {{ getTotalNumberOfDeviceType(Device.Mac) }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round(getTotalNumberOfDeviceType(Device.Mac) * 100 /
          getNumberOfPersons()) / 100 }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round(getTotalNumberOfDeviceType(Device.Mac) * 100 /
          teams.length) / 100 }}
        </div>
      </div>

      <!-- iOS Devices -->
      <div class="flex-row flex-center">
        <div class="flex-neutral-grow flex-no-shrink statistics-general-header">
          Persons with Mac Devices
        </div>
        <div class="flex-neutral-grow">
          {{ getTotalNumberOfDeviceType(Device.Mac) }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round(getTotalNumberOfDeviceType(Device.Mac) * 100 /
          getNumberOfPersons()) / 100 }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round(getTotalNumberOfDeviceType(Device.Mac) * 100 /
          teams.length) / 100 }}
        </div>
      </div>

      <!-- Female Persons -->
      <div class="flex-row flex-center">
        <div class="flex-neutral-grow flex-no-shrink statistics-general-header">
          Female Persosn
        </div>
        <div class="flex-neutral-grow">
          {{ getNumberOfPersonsWithGender(Gender.Female) }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round(getNumberOfPersonsWithGender(Gender.Female) * 100 /
          getNumberOfPersons()) / 100 }}
        </div>
        <div class="flex-neutral-grow">
          {{ Math.round(getNumberOfPersonsWithGender(Gender.Female) * 100 /
          teams.length) / 100 }}
        </div>
      </div>
    </div>
  </div>

  <!-- person preview cards -->
  <div class="flex-grow flex-row position-relative">
    <div *ngIf="orphanTeam.persons.length == 0"
         class="position-absolute position-absolute-full-size pointer-events-none flex-row overflow-hidden">
      <div class="flex-grow empty-orphan-team-hint-box flex-row flex-center flex-justify-center">
        <div>Drag persons here</div>
      </div>
    </div>
    <div [dragula]='"first-bag"' class='flex-column person-pool-preview-row flex-wrap flex-grow'
         [dragulaModel]="orphanTeam.persons">
      <app-person-preview *ngFor="let person of orphanTeam.persons" [person]="person"
                          (click)="showPersonDetails(person)"></app-person-preview>
    </div>
  </div>

</div>
